# ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. ‚úÖ Rate Limiting
**–§–∞–π–ª:** `server/middleware/rateLimiter.ts`

- **–û–±—â–∏–π –ª–∏–º–∏—Ç**: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 15 –º–∏–Ω—É—Ç –Ω–∞ IP
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: 5 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞ 15 –º–∏–Ω—É—Ç
- **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**: 20 —Å–æ–∑–¥–∞–Ω–∏–π –∑–∞ —á–∞—Å
- **–°–æ–æ–±—â–µ–Ω–∏—è**: 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É

### 2. ‚úÖ Security Headers
**–§–∞–π–ª:** `server/middleware/security.ts`

- Content Security Policy (CSP) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è Telegram –∏ –∫–∞—Ä—Ç
- HSTS (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π HTTPS –Ω–∞ 1 –≥–æ–¥)
- –ó–∞—â–∏—Ç–∞ –æ—Ç clickjacking
- XSS Protection
- –û—Ç–∫–ª—é—á–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ

### 3. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª:** `server/middleware/validator.ts`

- –í–∞–ª–∏–¥–∞—Ü–∏—è email –∏ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è UUID –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–µ–∑–¥–æ–∫ (–≥–æ—Ä–æ–¥–∞, –¥–∞—Ç–∞, –≤—Ä–µ–º—è, —Ü–µ–Ω–∞)
- Sanitization —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π (—É–¥–∞–ª–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤)

### 4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ routes
**–§–∞–π–ª:** `server/index.ts`

–í—Å–µ routes —Ç–µ–ø–µ—Ä—å –∑–∞—â–∏—â–µ–Ω—ã:
- `/api/auth/*` - rate limiting + –≤–∞–ª–∏–¥–∞—Ü–∏—è
- `/api/rides` (POST) - rate limiting + –≤–∞–ª–∏–¥–∞—Ü–∏—è
- `/api/*/:id` - –≤–∞–ª–∏–¥–∞—Ü–∏—è UUID
- `/api/messages` - rate limiting –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /var/www/ride-together/server
npm install express-rate-limit helmet
npm install --save-dev @types/express-rate-limit
```

### –®–∞–≥ 2: –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ TypeScript
npm run build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ PM2
pm2 restart ride-backend --update-env

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sleep 3
curl -s http://localhost:3001/health
pm2 logs ride-backend --lines 10 --nostream
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç rate limiting (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫)
for i in {1..6}; do
  curl -X POST http://localhost:3001/api/auth/signin \
    -H "Content-Type: application/json" \
    -d '{"email":"test@test.com","password":"test"}' | jq .
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ security headers
curl -I http://localhost:3001/health | grep -i "x-\|strict\|frame"
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CSP** - –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–Ω–µ—à–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ rate limits** - –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. **Whitelist –¥–ª—è trusted IPs** - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ IP

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏:

- Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ IP –∞–¥—Ä–µ—Å–∞
- –í development —Ä–µ–∂–∏–º–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (127.0.0.1) –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- Security headers –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å Nginx - –µ—Å–ª–∏ –±—É–¥—É—Ç –ø—Ä–æ–±–ª–µ–º—ã, –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é helmet
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã

