# Ride Together - Платформа для совместных поездок

Современное веб-приложение для поиска попутчиков и организации совместных поездок. Позволяет водителям публиковать поездки, а пассажирам находить и бронировать места.

![Ride Together](https://img.shields.io/badge/React-18.3.1-blue) ![TypeScript](https://img.shields.io/badge/TypeScript-5.8.3-blue) ![Vite](https://img.shields.io/badge/Vite-5.4.19-purple) ![Supabase](https://img.shields.io/badge/Supabase-2.87.1-green)

## Основные возможности

- **Аутентификация** - Регистрация и вход через email/password
- **Карты и геолокация** - Выбор маршрута на карте, отображение поездок (Yandex Maps)
- **Публикация поездок** - Водители могут создавать поездки с детальной информацией
- **Поиск поездок** - Фильтрация по городам, дате и количеству мест с отображением на карте
- **Бронирование** - Пассажиры могут бронировать места в поездках
- **Подтверждение бронирований** - Водители подтверждают заявки пассажиров
- **Рейтинги и отзывы** - Система отзывов после завершенных поездок
- **Чат** - Встроенный чат для общения участников поездки
- **Профили** - Управление профилем, рейтинги и история поездок
- **Модерация** - Система жалоб и админ панель для управления
- **PWA** - Установка как приложение на мобильных устройствах
- **Адаптивный дизайн** - Оптимизировано для всех устройств

## Технологии

- **Frontend:**
  - React 18.3.1
  - TypeScript 5.8.3
  - Vite 5.4.19
  - Tailwind CSS 3.4.17
  - shadcn/ui компоненты
  - React Router 6.30.1
  - React Query 5.83.0
  - React Hook Form 7.61.1
  - Zod 3.25.76
  - Yandex Maps JavaScript API 2.1

- **Backend:**
  - Supabase (PostgreSQL, Auth, Realtime)
  - Row Level Security (RLS)
  - Realtime подписки для чата

## Требования

- Node.js 18+ (рекомендуется использовать [nvm](https://github.com/nvm-sh/nvm))
- npm или yarn
- Аккаунт Supabase (бесплатный план доступен)
- Yandex Maps API ключ (опционально для карт)

## Быстрый старт

### 1. Клонирование репозитория

```bash
git clone https://github.com/ahmed11551/ride-together.git
cd ride-together
```

### 2. Установка зависимостей

```bash
npm install
```

### 3. Создание Supabase проекта

1. Зарегистрируйтесь на [supabase.com](https://supabase.com)
2. Создайте новый проект
3. Запишите Project URL и API keys

### 4. Настройка переменных окружения

Скопируйте файл `.env.example` в `.env`:

```bash
cp .env.example .env
```

Откройте `.env` и заполните переменные:

```env
VITE_SUPABASE_URL=https://your-project-ref.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=your-anon-key-here
VITE_YANDEX_MAPS_API_KEY=your-yandex-maps-api-key-here
VITE_TELEGRAM_BOT_TOKEN=your-telegram-bot-token-here
VITE_VAPID_PUBLIC_KEY=your-vapid-public-key-here
```

**Где найти эти значения:**

**Supabase:**
1. Зайдите в [Supabase Dashboard](https://app.supabase.com)
2. Выберите ваш проект (или создайте новый)
3. Перейдите в Settings → API
4. Скопируйте:
   - **Project URL** → `VITE_SUPABASE_URL`
   - **anon/public key** → `VITE_SUPABASE_PUBLISHABLE_KEY`

**Yandex Maps (опционально):**
1. Зарегистрируйтесь на [developer.tech.yandex.ru](https://developer.tech.yandex.ru/)
2. Создайте API ключ для JavaScript API и HTTP Geocoder
3. Скопируйте ключ → `VITE_YANDEX_MAPS_API_KEY`

### 5. Настройка базы данных

Примените миграции из папки `supabase/migrations/`:

1. В Supabase Dashboard перейдите в SQL Editor
2. Выполните миграции в следующем порядке:
   - `20251213021331_7a00ec87-3392-4efa-8263-d4d1fe272d41.sql` (основная схема)
   - `20251213021356_a5c9a937-87f4-46c5-8704-a93d5b858511.sql` (исправления)
   - `20250127000000_add_reports_and_admin.sql` (жалобы и админка)
   - `20250128000000_add_telegram_fields.sql` (Telegram поля)

Или используйте Supabase CLI:

```bash
supabase db push
```

**Настройка администратора:**
После создания аккаунта, сделайте себя администратором:
```sql
UPDATE public.profiles 
SET is_admin = true 
WHERE user_id = 'ваш-user-id';
```

### 6. Запуск приложения

```bash
npm run dev
```

Приложение будет доступно по адресу: `http://localhost:8080`

## Структура проекта

```
ride-together/
├── public/                 # Статические файлы
├── src/
│   ├── components/        # React компоненты
│   │   ├── chat/         # Компоненты чата
│   │   ├── home/         # Компоненты главной страницы
│   │   ├── layout/       # Компоненты layout
│   │   ├── rides/        # Компоненты поездок
│   │   ├── search/       # Компоненты поиска
│   │   └── ui/           # UI компоненты (shadcn/ui)
│   ├── contexts/         # React контексты
│   ├── hooks/            # Custom hooks
│   ├── integrations/     # Интеграции
│   │   └── supabase/     # Supabase клиент и типы
│   ├── lib/              # Утилиты
│   ├── pages/            # Страницы приложения
│   ├── App.tsx           # Главный компонент
│   └── main.tsx          # Точка входа
├── supabase/
│   ├── migrations/       # Миграции базы данных
│   └── config.toml       # Конфигурация Supabase
├── .env.example          # Пример переменных окружения
├── package.json
└── README.md
```

## Доступные команды

```bash
# Запуск dev сервера
npm run dev

# Сборка для production
npm run build

# Сборка для development
npm run build:dev

# Просмотр production сборки
npm run preview

# Линтинг кода
npm run lint

# Тестирование
npm test
```

## Аутентификация

Приложение использует Supabase Auth для аутентификации:

- **Регистрация:** Email + Password + Имя
- **Вход:** Email + Password
- **Telegram:** Автоматическая авторизация через Telegram Mini App
- Сессии хранятся в localStorage
- Автоматическое обновление токенов

## База данных

### Основные таблицы:

- **profiles** - Профили пользователей
- **driver_info** - Информация о водителях и автомобилях
- **rides** - Поездки
- **bookings** - Бронирования
- **messages** - Сообщения в чате
- **reviews** - Отзывы
- **reports** - Жалобы

### Безопасность:

- Row Level Security (RLS) включен для всех таблиц
- Политики доступа настроены для каждой таблицы
- Пользователи могут видеть только свои данные и публичные данные

## Тестирование

```bash
# Запуск тестов
npm test

# Запуск тестов с покрытием
npm test -- --coverage

# Запуск тестов в watch режиме
npm test -- --watch
```

## Деплой

### Vercel (рекомендуется)

Проект полностью настроен для деплоя на Vercel.

1. Откройте [vercel.com](https://vercel.com) и войдите через GitHub
2. Импортируйте проект из репозитория
3. Настройте переменные окружения в Settings → Environment Variables
4. Деплой произойдет автоматически

**После деплоя:**
- Каждый push в `main` автоматически деплоится
- Pull Requests получают preview деплои
- Приложение доступно по адресу `https://ride-together.vercel.app`

### Netlify

1. Установите [Netlify CLI](https://docs.netlify.com/cli/get-started/)
2. Задеплойте: `netlify deploy --prod`
3. Добавьте переменные окружения в Netlify Dashboard

### Ручной деплой

```bash
# Сборка
npm run build

# Файлы будут в папке dist/
# Загрузите их на ваш хостинг
```

## Карты и геолокация

Приложение поддерживает интеграцию с Yandex Maps для:

- **Выбор маршрута на карте** - При создании поездки можно выбрать точки отправления и прибытия на интерактивной карте
- **Отображение поездок на карте** - В результатах поиска можно переключиться на вид карты и увидеть все поездки
- **Геокодирование** - Автоматическое преобразование адресов в координаты и наоборот
- **Определение местоположения** - Кнопка "Моё местоположение" для быстрого выбора текущей позиции

Карты работают в двух режимах:
- **Режим выбора** - Для выбора точек на карте (при создании поездки)
- **Режим просмотра** - Для отображения поездок на карте (в результатах поиска)

## Рейтинги и отзывы

После завершения поездки (статус "completed") участники могут оставить отзыв:

- Выбор рейтинга от 1 до 5 звезд
- Текстовый комментарий (опционально)
- Автоматическое обновление рейтинга пользователя
- Отображение отзывов в профиле

## Модерация и админ панель

### Система жалоб:

- Пользователи могут жаловаться на других участников
- Выбор причины жалобы из списка
- Описание ситуации
- Привязка к конкретной поездке

### Админ панель (`/admin`):

- Просмотр всех жалоб
- Изменение статуса жалоб (pending → reviewed → resolved/dismissed)
- Блокировка/разблокировка пользователей
- Заметки модератора

**Доступ:** Только для пользователей с `is_admin = true` в профиле

## PWA (Progressive Web App)

Приложение можно установить как PWA:

- Установка на домашний экран
- Офлайн режим (базовый)
- Быстрые shortcuts
- Нативный вид приложения

**Иконки:** Нужно добавить `icon-192.png` и `icon-512.png` в `public/`

## Планы на будущее

- [x] Интеграция Yandex Maps для выбора маршрута
- [x] Система рейтингов и отзывов
- [x] Админ панель и модерация
- [x] PWA функциональность
- [x] Push-уведомления
- [ ] Построение маршрута между точками на карте
- [ ] Верификация водителей (загрузка фото авто и документов)
- [ ] Мобильное приложение (React Native)
- [ ] Интеграция платежей
- [ ] OAuth авторизация (Google, GitHub)

## Поддержка

Если у вас возникли вопросы или проблемы:

1. Проверьте [Issues](https://github.com/ahmed11551/ride-together/issues)
2. Создайте новый Issue с описанием проблемы
3. Или свяжитесь с разработчиком

## Благодарности

- [Supabase](https://supabase.com) - за отличный backend-as-a-service
- [shadcn/ui](https://ui.shadcn.com) - за красивые UI компоненты
- [Vite](https://vitejs.dev) - за быструю сборку
- [React](https://react.dev) - за отличный фреймворк

---

**Сделано для удобных поездок**
