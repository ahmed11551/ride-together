# üéâ –í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã!

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏:

### 1. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- Rate limiting –¥–ª—è –≤—Å–µ—Ö API endpoints
- Security headers (helmet)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (zod)
- UUID –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### 2. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (JSON –≤ production)
- Sentry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Request logging middleware
- Error handler middleware
- Database query logging

### 3. ‚úÖ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- Email —Å–µ—Ä–≤–∏—Å (SMTP/Resend)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å–æ–±—ã—Ç–∏—è (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
- API endpoints –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (email, push, telegram)

### 4. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π API –ø–æ–∏—Å–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–µ, –≤—Ä–µ–º–µ–Ω–∏, —Ü–µ–Ω–µ, —Ä–µ–π—Ç–∏–Ω–≥—É
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º (–∫—É—Ä–µ–Ω–∏–µ, –ø–∏—Ç–æ–º—Ü—ã, –º—É–∑—ã–∫–∞)
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ –ø–æ–∏—Å–∫–∞–º–∏

### 5. ‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
- –ì–µ–æ–∫–æ–¥–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å (Yandex Maps / Nominatim)
- –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ–∏—Å–∫ –ø–æ–µ–∑–¥–æ–∫ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏
- –û–±—Ä–∞—Ç–Ω—ã–π –≥–µ–æ–∫–æ–¥–∏–Ω–≥

### 6. ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (admin only)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
cd /var/www/ride-together/server

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install @sentry/node nodemailer

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∏–ø–æ–≤
npm install --save-dev @types/nodemailer

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
npm run build
```

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
psql -U ride_user -d ride_together -f migrations/add_notifications_table.sql
psql -U ride_user -d ride_together -f migrations/add_saved_searches_table.sql
psql -U ride_user -d ride_together -f migrations/add_location_tables.sql
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û–±–Ω–æ–≤–∏—Ç–µ `ecosystem.config.cjs`:

```javascript
env: {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  LOG_LEVEL: 'info', // debug, info, warn, error
  SENTRY_DSN: 'https://...@sentry.io/...', // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  
  // Email
  EMAIL_PROVIDER: 'smtp', // –∏–ª–∏ 'resend'
  EMAIL_FROM: 'noreply@ridetogether.ru',
  SMTP_HOST: 'smtp.gmail.com',
  SMTP_PORT: '587',
  SMTP_SECURE: 'false',
  SMTP_USER: 'your-email@gmail.com',
  SMTP_PASS: 'your-app-password',
  // –ò–õ–ò –¥–ª—è Resend:
  // RESEND_API_KEY: 're_xxxxxxxxxxxxx',
  
  // –ì–µ–æ–∫–æ–¥–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  GEOCODING_PROVIDER: 'nominatim', // –∏–ª–∏ 'yandex'
  YANDEX_MAPS_API_KEY: 'your-key', // –¢–æ–ª—å–∫–æ –¥–ª—è Yandex
  GEOCODING_CACHE: 'true',
}
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
pm2 restart ride-backend --update-env
pm2 logs ride-backend --lines 20
```

---

## üìä –ù–æ–≤—ã–µ API endpoints:

### –ì–µ–æ–∫–æ–¥–∏–Ω–≥:
- `GET /api/geocoding/geocode?address=...`
- `GET /api/geocoding/reverse?lat=...&lng=...`

### –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:
- `GET /api/location`
- `POST /api/location`

### –ü–æ–∏—Å–∫:
- `GET /api/rides/search` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
- `GET /api/rides/nearby?lat=...&lng=...&radius=...`

### –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∏:
- `GET /api/saved-searches`
- `POST /api/saved-searches`
- `PUT /api/saved-searches/:id`
- `DELETE /api/saved-searches/:id`

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
- `GET /api/notifications`
- `PUT /api/notifications/:id/read`
- `PUT /api/notifications/read-all`

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- `GET /api/stats/user`
- `GET /api/stats/platform` (admin only)

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- ‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–ì–æ—Ç–æ–≤–æ –∫ production! üöÄ**

