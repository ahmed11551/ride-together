# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞ –¥–ª—è Ride Together

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω—ã API endpoints –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫:
   - `POST /api/telegram/subscribe` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –±–æ—Ç–∞
   - `POST /api/telegram/unsubscribe` - –æ—Ç–ø–∏—Å–∫–∞ –æ—Ç –±–æ—Ç–∞
   - `GET /api/telegram/status` - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏

2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API –≤–º–µ—Å—Ç–æ Supabase
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–æ—Ç (RideConnect ‚Üí Ride Together)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞:

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –≤ Telegram

1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è: `Ride Together Bot`
4. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ username: `RideTogetherBot` (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ Bot)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –¥–∞—Å—Ç BotFather

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±–Ω–æ–≤–∏—Ç–µ `.env.production`:

```bash
cd /var/www/ride-together/server
nano .env.production
```

–î–æ–±–∞–≤—å—Ç–µ:
```env
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
```

–ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ `ecosystem.config.cjs`:
```javascript
env: {
  // ... –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  TELEGRAM_BOT_TOKEN: 'your_bot_token_from_botfather',
}
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –¥–ª—è –±–æ—Ç–∞

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase Edge Function. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä, –Ω—É–∂–Ω–æ:

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Supabase (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)**

1. –î–µ–ø–ª–æ–π Edge Function:
```bash
cd ride-together
supabase functions deploy telegram-bot
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook:
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -d "url=https://<your-project>.supabase.co/functions/v1/telegram-bot"
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –°–æ–∑–¥–∞—Ç—å webhook –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ**

–°–æ–∑–¥–∞–π—Ç–µ endpoint –Ω–∞ –±—ç–∫–µ–Ω–¥–µ:

```typescript
// server/api/telegram/webhook.ts
app.post('/api/telegram/webhook', async (req, res) => {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç Telegram
  // –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏–∫—É –∏–∑ supabase/functions/telegram-bot/index.ts
});
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

–í `.env.production` –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¥–µ–ø–ª–æ—è:

```env
VITE_TELEGRAM_BOT_TOKEN=RideTogetherBot  # –∏–ª–∏ –≤–∞—à–µ –∏–º—è –±–æ—Ç–∞
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ APP_URL –≤ –±–æ—Ç–µ

–í `supabase/functions/telegram-bot/index.ts` –æ–±–Ω–æ–≤–∏—Ç–µ:

```typescript
const APP_URL = Deno.env.get("APP_URL") || "https://ridetogether.ru";
```

–ò —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Supabase:
```
APP_URL=https://ridetogether.ru
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ API

```bash
# –ü–æ–¥–ø–∏—Å–∫–∞
curl -X POST https://api.ridetogether.ru/api/telegram/subscribe \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "telegram_user_id": 123456789,
    "telegram_username": "test_user",
    "telegram_first_name": "Test"
  }'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl https://api.ridetogether.ru/api/telegram/status \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram: `@RideTogetherBot`
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é

## üìã –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –º–µ–Ω—é
- `/help` - –ø–æ–º–æ—â—å
- `/my_rides` - –º–æ–∏ –ø–æ–µ–∑–¥–∫–∏
- `/search_rides` - –ø–æ–∏—Å–∫ –ø–æ–µ–∑–¥–æ–∫
- `/support` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- `/reviews` - –æ—Ç–∑—ã–≤—ã
- `/premium` - –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞
- `/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. **–ü–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –±–æ—Ç–∞"
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–æ—Ç –≤ Telegram
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `/start subscribe`
   - –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
   - –í –ø—Ä–æ—Ñ–∏–ª–µ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
   - API `/api/telegram/status` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

1. **–¢–æ–∫–µ–Ω –±–æ—Ç–∞:** –•—Ä–∞–Ω–∏—Ç–µ –≤ —Å–µ–∫—Ä–µ—Ç–µ, –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ git
2. **Webhook URL:** –î–æ–ª–∂–µ–Ω –±—ã—Ç—å HTTPS
3. **–ë–î:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã `bot_users` –∏ `subscriptions` —Å—É—â–µ—Å—Ç–≤—É—é—Ç
4. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:** –û–±–Ω–æ–≤–∏—Ç–µ APP_URL –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase Function –∏–ª–∏ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (—Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ)

### –û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î

