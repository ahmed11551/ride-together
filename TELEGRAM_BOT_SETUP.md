# Настройка Telegram бота и монетизации

## Шаг 1: Создание бота через BotFather

1. Откройте Telegram и найдите [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям:
   - Введите имя бота (например: `RideConnect`)
   - Введите username бота (например: `RideConnectBot`)
4. Сохраните токен бота (формат: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

## Шаг 2: Настройка Webhook для бота

### Вариант 1: Использование Supabase Edge Function

1. Деплой Edge Function:
```bash
supabase functions deploy telegram-bot
```

2. Установите переменные окружения в Supabase:
   - `TELEGRAM_BOT_TOKEN` - токен бота от BotFather
   - `APP_URL` - URL вашего приложения (например: `https://your-app.vercel.app`)

3. Установите webhook:
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://<YOUR_SUPABASE_PROJECT>.supabase.co/functions/v1/telegram-bot"
  }'
```

### Вариант 2: Использование отдельного сервера

Если вы используете отдельный сервер, настройте webhook аналогично.

## Шаг 3: Настройка Mini App

1. В BotFather отправьте команду `/newapp`
2. Выберите вашего бота
3. Введите:
   - **Title**: `RideConnect`
   - **Description**: `Платформа для совместных поездок`
   - **Photo**: Загрузите иконку приложения
   - **Short name**: `rideconnect` (будет использоваться в URL)
   - **Web App URL**: `https://your-app.vercel.app`

4. BotFather предоставит ссылку вида: `https://t.me/YourBot/rideconnect`

## Шаг 4: Настройка переменных окружения

Добавьте в `.env` и Vercel:

```env
VITE_TELEGRAM_BOT_TOKEN=your_bot_token_here
```

В Supabase Edge Function добавьте:
- `TELEGRAM_BOT_TOKEN` - токен бота
- `APP_URL` - URL вашего приложения
- `SUPABASE_URL` - URL вашего Supabase проекта
- `SUPABASE_SERVICE_ROLE_KEY` - Service Role ключ (уже должен быть)

## Шаг 5: Применение миграций

```bash
supabase migration up
```

Это создаст таблицы:
- `subscriptions` - подписки пользователей
- `bot_users` - пользователи бота
- `referrals` - реферальная система

## Шаг 6: Тестирование

1. Найдите вашего бота в Telegram
2. Отправьте `/start`
3. Проверьте, что бот отвечает
4. Нажмите кнопку "Открыть приложение"
5. Проверьте, что приложение открывается

## Команды бота

- `/start` - Начать работу с ботом
- `/help` - Показать справку
- `/subscribe` - Подписаться на уведомления

## Кнопки бота

- **Открыть приложение** - открывает Mini App
- **Мои поездки** - открывает раздел "Мои поездки"
- **Найти поездку** - открывает поиск
- **Получить Premium** - информация о Premium (пока бесплатно)

## Монетизация (будущее)

### Текущий статус: Бесплатно

Все функции доступны бесплатно. Инфраструктура для монетизации подготовлена:

1. **Таблица подписок** (`subscriptions`):
   - `free` - бесплатная подписка (текущая)
   - `premium` - премиум подписка (будущее)
   - `premium_plus` - расширенная премиум подписка (будущее)

2. **Статусы подписок**:
   - `active` - активная
   - `cancelled` - отменена
   - `expired` - истекла

3. **Реферальная система** (`referrals`):
   - Готова для внедрения программы лояльности
   - Отслеживание рефералов
   - Награды за приглашения

### Планы на будущее

1. **Premium подписка**:
   - Приоритет в поиске
   - Расширенные уведомления
   - Статистика поездок
   - Без рекламы
   - Поддержка 24/7

2. **Методы оплаты**:
   - Telegram Stars (когда будет доступно)
   - Stripe
   - YooKassa
   - Криптовалюты

3. **Реферальная программа**:
   - Пригласи друга - получи Premium на месяц
   - Накопительные бонусы
   - Специальные предложения

## Аналитика

Используйте таблицу `bot_users` для отслеживания:
- Количество подписчиков
- Активность пользователей
- Конверсия в подписки

## Уведомления

Бот может отправлять уведомления о:
- Новых поездках по вашему маршруту
- Подтверждении бронирования
- Напоминаниях о поездках
- Специальных предложениях

## Безопасность

1. **Токен бота**: Храните в секретах, никогда не коммитьте в репозиторий
2. **Валидация данных**: Всегда проверяйте данные от Telegram на сервере
3. **RLS политики**: Настроены для защиты данных пользователей

## Поддержка

Если возникли проблемы:
1. Проверьте логи Edge Function в Supabase Dashboard
2. Проверьте webhook через: `https://api.telegram.org/bot<TOKEN>/getWebhookInfo`
3. Убедитесь, что все переменные окружения установлены

