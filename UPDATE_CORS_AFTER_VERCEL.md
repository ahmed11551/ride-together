# üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CORS –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è Vercel

## –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Vercel, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç–µ CORS –Ω–∞ –±—ç–∫–µ–Ω–¥–µ**.

## –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ –¥–æ–º–µ–Ω Vercel

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤ Vercel Dashboard –≤—ã —É–≤–∏–¥–∏—Ç–µ URL:
- Production: `https://your-app-abc123.vercel.app`
- –ò–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–æ–º–µ–Ω: `https://app.yourdomain.com`

**–ó–∞–ø–∏—à–∏—Ç–µ —ç—Ç–æ—Ç URL!**

## –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ ALLOWED_ORIGINS –≤ Timeweb

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Timeweb

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Timeweb Cloud](https://timeweb.cloud/my/projects/2005839)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à–µ –±—ç–∫–µ–Ω–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –û—Ç–∫—Ä–æ–π—Ç–µ **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"** ‚Üí **"–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"** (–∏–ª–∏ **"Environment Variables"**)
4. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ALLOWED_ORIGINS`
5. –û–±–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
   ```
   https://your-app-abc123.vercel.app,https://www.your-app-abc123.vercel.app
   ```
   
   **–ò–ª–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—Å–µ—Ö preview –≤–µ—Ç–æ–∫:**
   ```
   https://your-app-abc123.vercel.app,https://*.vercel.app
   ```

6. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π .env (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Git –¥–µ–ø–ª–æ–π)

1. –û–±–Ω–æ–≤–∏—Ç–µ `server/.env`:
   ```env
   ALLOWED_ORIGINS=https://your-app-abc123.vercel.app,https://*.vercel.app
   ```

2. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ:
   ```bash
   cd server
   git add .env
   git commit -m "Update CORS for Vercel domain"
   git push
   ```

3. Timeweb –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥

1. –í Timeweb Cloud ‚Üí –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ **"–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å"** –∏–ª–∏ **"Redeploy"**
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (–æ–±—ã—á–Ω–æ 1-2 –º–∏–Ω—É—Ç—ã)

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞

### 4.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à Vercel –¥–æ–º–µ–Ω
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí **Network**
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏–ª–∏ –≤–æ–π—Ç–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç API:
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: `Access-Control-Allow-Origin: https://your-app-abc123.vercel.app`
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ CORS –≤ –∫–æ–Ω—Å–æ–ª–∏

### 4.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl

```bash
curl -H "Origin: https://your-app-abc123.vercel.app" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -X OPTIONS \
     https://your-backend-url.twc1.net/api/auth/signup
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
Access-Control-Allow-Origin: https://your-app-abc123.vercel.app
```

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –¢–æ–ª—å–∫–æ production –¥–æ–º–µ–Ω
```env
ALLOWED_ORIGINS=https://your-app.vercel.app
```

### Production + www
```env
ALLOWED_ORIGINS=https://your-app.vercel.app,https://www.your-app.vercel.app
```

### Production + –≤—Å–µ preview –≤–µ—Ç–∫–∏
```env
ALLOWED_ORIGINS=https://your-app.vercel.app,https://*.vercel.app
```

### Production + –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–æ–º–µ–Ω
```env
ALLOWED_ORIGINS=https://your-app.vercel.app,https://app.yourdomain.com
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ + production
```env
ALLOWED_ORIGINS=http://localhost:8080,http://localhost:5173,https://your-app.vercel.app
```

## Troubleshooting

### CORS –æ—à–∏–±–∫–∞ –≤—Å–µ –µ—â–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `ALLOWED_ORIGINS` –æ—à–∏–±–∫–∞ –Ω–µ –∏—Å—á–µ–∑–ª–∞

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞ (—Å `https://`, –±–µ–∑ —Å–ª–µ—à–∞ –≤ –∫–æ–Ω—Ü–µ)
3. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R / Cmd+Shift+R)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–µ–Ω–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–æ–±–ª–µ–º–∞**: –û–¥–∏–Ω –¥–æ–º–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥—Ä—É–≥–æ–π –Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –∑–∞–ø—è—Ç–æ–π –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –¥–æ–º–µ–Ω—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `https://`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏–ª–∏ —Å–∏–º–≤–æ–ª–æ–≤

### Preview –≤–µ—Ç–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–æ–±–ª–µ–º–∞**: Production —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ preview –≤–µ—Ç–∫–∏ –ø–æ–ª—É—á–∞—é—Ç CORS –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ**:
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ wildcard:
```env
ALLOWED_ORIGINS=https://your-app.vercel.app,https://*.vercel.app
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ preview –¥–æ–º–µ–Ω—ã:
```env
ALLOWED_ORIGINS=https://your-app.vercel.app,https://your-app-git-feature-username.vercel.app
```

## –í–∞–∂–Ω–æ

‚ö†Ô∏è **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `*` –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤ –≤ production** - —ç—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ!

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã** –∏–ª–∏ `*.vercel.app` —Ç–æ–ª—å–∫–æ –¥–ª—è preview –≤–µ—Ç–æ–∫

‚úÖ **–í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π—Ç–µ –±—ç–∫–µ–Ω–¥** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] –ü–æ–ª—É—á–µ–Ω –¥–æ–º–µ–Ω Vercel
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω `ALLOWED_ORIGINS` –≤ Timeweb
- [ ] –ë—ç–∫–µ–Ω–¥ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–Ω–µ—Ç CORS –æ—à–∏–±–æ–∫)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ (Access-Control-Allow-Origin)

## –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS:
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, Analytics)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–æ–º–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
