# ❌ Объяснение ошибки ERR_INVALID_URL

## Проблема:

```
code: 'ERR_INVALID_URL',
input: '/api/rides?limit=10&status=active'
```

## Причина:

В скомпилированном JavaScript файле (`dist/api/rides/list.js`) используется конструктор `new URL()` с относительным путем `/api/rides?limit=10&status=active`.

**`new URL()` требует абсолютный URL** (например: `https://example.com/api/rides?limit=10`), а не относительный путь.

## Откуда берется эта ошибка:

1. **TypeScript компилятор** иногда может генерировать код, который пытается парсить URL через `new URL()`
2. **Или** в коде есть старый код, который использует `new URL(req.url)` для парсинга query параметров
3. **Или** код был скопирован из другого проекта, где использовался `new URL()` для работы с URL

## Правильное решение:

В Express.js нужно использовать **`req.query`** для получения query параметров, а не парсить URL вручную.

### ❌ Неправильно:
```javascript
const url = new URL(req.url);  // ОШИБКА! req.url - относительный путь
const limit = url.searchParams.get('limit');
```

### ✅ Правильно:
```javascript
const limit = req.query.limit;
const status = req.query.status;
```

## Исправление:

1. **Пересобрать проект** (чтобы получить свежий скомпилированный код)
2. **Исправить скомпилированные файлы** - заменить `new URL(req.url)` и `url.searchParams.get()` на `req.query`

---

## Команды для исправления:

```bash
cd /var/www/ride-together/server

# Вариант 1: Пересобрать и исправить
bash REBUILD_AND_FIX.sh

# Вариант 2: Исправить только скомпилированные файлы
find dist/api/rides -name "*.js" -exec sed -i '/new URL(req\.url)/d' {} \;
find dist/api/rides -name "*.js" -exec python3 -c "
import re, sys
with open(sys.argv[1], 'r') as f: content = f.read()
content = re.sub(r\"url\.searchParams\.get\(['\"](\w+)['\"]\)\", r'req.query.\1', content)
with open(sys.argv[1], 'w') as f: f.write(content)
" {} \;

pm2 restart ride-backend
```

