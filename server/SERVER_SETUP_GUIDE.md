# üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —É–ª—É—á—à–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@194.67.124.123
# –∏–ª–∏
ssh root@cv5600437
```

### 2. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd /var/www/ride-together/server
```

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ npm –ø–∞–∫–µ—Ç–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install @sentry/node nodemailer

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∏–ø–æ–≤ –¥–ª—è TypeScript
npm install --save-dev @types/nodemailer
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
npm list @sentry/node nodemailer
```

---

## –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –®–∞–≥ 2: –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript

```bash
npm run build
```

–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ TypeScript, –Ω–æ JS —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–ª–∏—Å—å, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å (–æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã).

–ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
ls -la dist/
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ dist/services/, dist/api/, dist/utils/
```

---

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

### –®–∞–≥ 3: –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É:

```bash
# 1. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
psql -U ride_user -d ride_together -f migrations/add_notifications_table.sql

# 2. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤
psql -U ride_user -d ride_together -f migrations/add_saved_searches_table.sql

# 3. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
psql -U ride_user -d ride_together -f migrations/add_location_tables.sql
```

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ.

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü:
```bash
psql -U ride_user -d ride_together -c "\dt" | grep -E "notifications|saved_searches|user_locations"
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ecosystem.config.cjs

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `ecosystem.config.cjs`:

```bash
nano ecosystem.config.cjs
# –∏–ª–∏
vim ecosystem.config.cjs
```

–î–æ–±–∞–≤—å—Ç–µ/–æ–±–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Å–µ–∫—Ü–∏–∏ `env`:

```javascript
env: {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ...
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  LOG_LEVEL: 'info', // debug, info, warn, error
  // SENTRY_DSN: 'https://...@sentry.io/...', // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Sentry
  
  // Email (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç)
  EMAIL_PROVIDER: 'smtp', // –∏–ª–∏ 'resend'
  EMAIL_FROM: 'noreply@ridetogether.ru',
  
  // –í–∞—Ä–∏–∞–Ω—Ç 1: SMTP
  SMTP_HOST: 'smtp.gmail.com',
  SMTP_PORT: '587',
  SMTP_SECURE: 'false',
  SMTP_USER: 'your-email@gmail.com',
  SMTP_PASS: 'your-app-password',
  
  // –í–∞—Ä–∏–∞–Ω—Ç 2: Resend (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)
  // EMAIL_PROVIDER: 'resend',
  // RESEND_API_KEY: 're_xxxxxxxxxxxxx',
  
  // –ì–µ–æ–∫–æ–¥–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  GEOCODING_PROVIDER: 'nominatim', // 'nominatim' (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π) –∏–ª–∏ 'yandex'
  // YANDEX_MAPS_API_KEY: 'your-yandex-api-key', // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Yandex
  GEOCODING_CACHE: 'true',
}
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª (Ctrl+O, Enter, Ctrl+X –¥–ª—è nano).

---

## –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ PM2 —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

```bash
# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å (—á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
pm2 delete ride-backend

# –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–Ω–æ–≤–æ
pm2 start ecosystem.config.cjs

# –ò–ª–∏ –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è
pm2 restart ride-backend --update-env

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
pm2 status

# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏
pm2 logs ride-backend --lines 50
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoints

```bash
# Health check
curl http://localhost:3001/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ endpoint –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞ (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –Ω–æ –Ω–µ 404)
curl "http://localhost:3001/api/geocoding/geocode?address=–ú–æ—Å–∫–≤–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)
curl http://localhost:3001/api/stats/platform
```

---

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x INSTALL_IMPROVEMENTS.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
./INSTALL_IMPROVEMENTS.sh
```

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ npm –ø–∞–∫–µ—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à npm
npm cache clean --force

# –£–¥–∞–ª–∏—Ç—å node_modules –∏ package-lock.json
rm -rf node_modules package-lock.json

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install
npm install @sentry/node nodemailer
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü—ã
psql -U ride_user -d ride_together -c "\dt" | grep notifications

# –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã —É–∂–µ –µ—Å—Ç—å, –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞ - –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
pm2 logs ride-backend --err --lines 50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å JavaScript
node --check dist/index.js

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã
ls -la dist/api/geocoding/
ls -la dist/services/
```

### –ü—Ä–æ–±–ª–µ–º–∞: PM2 –Ω–µ –≤–∏–¥–∏—Ç –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PM2
pm2 delete ride-backend
pm2 start ecosystem.config.cjs

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
pm2 show ride-backend | grep "env:"
```

---

## –ß–µ–∫–ª–∏—Å—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`npm list @sentry/node nodemailer`)
- [ ] –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω (`ls dist/`)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î)
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã (`cat ecosystem.config.cjs | grep EMAIL`)
- [ ] PM2 –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω (`pm2 status`)
- [ ] –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç (`curl http://localhost:3001/health`)
- [ ] –õ–æ–≥–∏ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ (`pm2 logs ride-backend`)

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Sentry

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://sentry.io
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç (Node.js)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ DSN
4. –î–æ–±–∞–≤—å—Ç–µ –≤ `ecosystem.config.cjs`:
   ```javascript
   SENTRY_DSN: 'https://...@sentry.io/...'
   ```
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PM2

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email (Resend - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://resend.com
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á
3. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π)
4. –î–æ–±–∞–≤—å—Ç–µ –≤ `ecosystem.config.cjs`:
   ```javascript
   EMAIL_PROVIDER: 'resend',
   RESEND_API_KEY: 're_xxxxxxxxxxxxx',
   ```
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PM2

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email (SMTP - Gmail)

1. –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ Google Account
2. –°–æ–∑–¥–∞–π—Ç–µ App Password: https://myaccount.google.com/apppasswords
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `ecosystem.config.cjs`:
   ```javascript
   SMTP_HOST: 'smtp.gmail.com',
   SMTP_PORT: '587',
   SMTP_SECURE: 'false',
   SMTP_USER: 'your-email@gmail.com',
   SMTP_PASS: 'your-app-password',
   ```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PM2

---

## –ì–æ—Ç–æ–≤–æ! üéâ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ –≤—Å–µ–º–∏ –Ω–æ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
- ‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

