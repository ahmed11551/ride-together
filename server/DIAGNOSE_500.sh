#!/bin/bash

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ 500
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: bash DIAGNOSE_500.sh

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ 500..."
echo ""

echo "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PM2:"
pm2 status
echo ""

echo "2Ô∏è‚É£ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ (30 —Å—Ç—Ä–æ–∫):"
pm2 logs ride-backend --err --lines 30 --nostream
echo ""

echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ dist/index.js —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:"
ls -lh dist/index.js 2>/dev/null || echo "‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!"
echo ""

echo "4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ dist/index.js:"
node -c dist/index.js 2>&1 || echo "‚ùå –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞!"
echo ""

echo "5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è PM2:"
pm2 show ride-backend | grep -E "DATABASE_URL|JWT_SECRET" | head -2
echo ""

echo "6Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç:"
netstat -tlnp | grep 3001 || ss -tlnp | grep 3001 || echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 3001 –Ω–µ —Å–ª—É—à–∞–µ—Ç—Å—è"
echo ""

echo "7Ô∏è‚É£ –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API:"
curl -s http://localhost:3001/health || echo "‚ùå Health check –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
echo ""

echo "‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
echo ""
echo "üìã –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –≤—ã–≤–æ–¥ –≤—ã—à–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"

