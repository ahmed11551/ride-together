# üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –î–µ–ø–ª–æ–π –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ Timeweb

## –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

### 1.1 –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `server`

```bash
cd server
cp env.example .env
```

### 1.2 –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env` —Ñ–∞–π–ª

–û—Ç–∫—Ä–æ–π—Ç–µ `server/.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```env
# Database Configuration (Timeweb PostgreSQL)
TIMEWEB_DB_HOST=your-timeweb-db-host.twc1.net
TIMEWEB_DB_PORT=5432
TIMEWEB_DB_NAME=default_db
TIMEWEB_DB_USER=gen_user
TIMEWEB_DB_PASSWORD=your-password-here

# SSL Configuration
TIMEWEB_DB_SSL=true
TIMEWEB_DB_SSL_CERT=./ca.crt
TIMEWEB_DB_SSL_MODE=verify-full

# Server Configuration
PORT=3001
NODE_ENV=production

# JWT Configuration
# –í–ê–ñ–ù–û: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∫–æ–º–∞–Ω–¥–æ–π: openssl rand -base64 32
JWT_SECRET=your-generated-secret-key-here-min-32-chars
JWT_EXPIRES_IN=7d

# CORS Configuration
# –ü–æ–∫–∞ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ localhost –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
# –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è Vercel –æ–±–Ω–æ–≤–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
ALLOWED_ORIGINS=http://localhost:8080,http://localhost:5173

# WebSocket Configuration
WS_PORT=3001
```

**–ì–¥–µ –≤–∑—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–î:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [Timeweb Cloud](https://timeweb.cloud/my/projects/2005839)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí PostgreSQL
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
   - Host (–Ω–∞–ø—Ä–∏–º–µ—Ä: `9d497bc2bf9dd679bd9834af.twc1.net`)
   - Port (–æ–±—ã—á–Ω–æ `5432`)
   - Database (–æ–±—ã—á–Ω–æ `default_db`)
   - User (–æ–±—ã—á–Ω–æ `gen_user`)
   - Password (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫)

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT_SECRET:**
```bash
openssl rand -base64 32
```

### 1.3 –°–∫–æ–ø–∏—Ä—É–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ca.crt –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ server
cp ../ca.crt ./ca.crt
```

## –®–∞–≥ 2: –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Timeweb App Platform

### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Timeweb Cloud](https://timeweb.cloud/my/projects/2005839)
2. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å"** ‚Üí **"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"** (App Platform)
3. –í—ã–±–µ—Ä–∏—Ç–µ **"–ò–∑ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"** –∏–ª–∏ **"–ò–∑ –∞—Ä—Ö–∏–≤–∞"**

### 2.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - –£–∫–∞–∂–∏—Ç–µ –≤–µ—Ç–∫—É (–æ–±—ã—á–Ω–æ `main` –∏–ª–∏ `master`)
   - **Root Directory**: `ride-together/server` (–µ—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–æ—Ä–Ω–µ–≤–æ–π) –∏–ª–∏ `server` (–µ—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ç–æ–ª—å–∫–æ —Å server)

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–æ—Ä–∫–∏:**
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm start`
   - **Port**: `3001`

3. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - –ù–∞–∂–º–∏—Ç–µ **"–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"**
   - –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –≤–∞—à–µ–≥–æ `.env` —Ñ–∞–π–ª–∞:
     ```
     TIMEWEB_DB_HOST=...
     TIMEWEB_DB_PORT=5432
     TIMEWEB_DB_NAME=...
     TIMEWEB_DB_USER=...
     TIMEWEB_DB_PASSWORD=...
     TIMEWEB_DB_SSL=true
     TIMEWEB_DB_SSL_CERT=./ca.crt
     TIMEWEB_DB_SSL_MODE=verify-full
     PORT=3001
     NODE_ENV=production
     JWT_SECRET=...
     JWT_EXPIRES_IN=7d
     ALLOWED_ORIGINS=http://localhost:8080
     WS_PORT=3001
     ```

4. **–§–∞–π–ª—ã:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ca.crt` –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Timeweb

5. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**

### 2.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑ –∞—Ä—Ö–∏–≤–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

1. –°–æ–∑–¥–∞–π—Ç–µ –∞—Ä—Ö–∏–≤:
   ```bash
   cd server
   tar -czf ../server-deploy.tar.gz . --exclude=node_modules --exclude=.git
   ```

2. –í Timeweb:
   - –í—ã–±–µ—Ä–∏—Ç–µ **"–ò–∑ –∞—Ä—Ö–∏–≤–∞"**
   - –ó–∞–≥—Ä—É–∑–∏—Ç–µ `server-deploy.tar.gz`
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∫–∞–∫ –≤ —à–∞–≥–µ 2.2.3)
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Build –∏ Start –∫–æ–º–∞–Ω–¥—ã

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

### 3.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ —á–µ—Ä–µ–∑ curl:

```bash
curl https://your-app-url.twc1.net/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è:
```json
{"status":"ok","timestamp":"2024-01-31T..."}
```

### 3.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

1. –í Timeweb Cloud ‚Üí –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí **"–õ–æ–≥–∏"**
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è: `üöÄ Server running on port 3001`

### 3.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
# –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
curl -X POST https://your-app-url.twc1.net/api/auth/signup \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123","fullName":"Test User"}'
```

## –®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ URL –±—ç–∫–µ–Ω–¥–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:

1. –í Timeweb Cloud ‚Üí –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí **"–î–æ–º–µ–Ω—ã"**
2. –ó–∞–ø–∏—à–∏—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://api-12345.twc1.net`)
3. –≠—Ç–æ—Ç URL –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CORS (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è Vercel)

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ Vercel:

1. –ü–æ–ª—É—á–∏—Ç–µ –¥–æ–º–µ–Ω Vercel (–Ω–∞–ø—Ä–∏–º–µ—Ä: `your-app.vercel.app`)
2. –í Timeweb Cloud ‚Üí –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí **"–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"**
3. –û–±–Ω–æ–≤–∏—Ç–µ `ALLOWED_ORIGINS`:
   ```
   ALLOWED_ORIGINS=https://your-app.vercel.app,https://www.your-app.vercel.app
   ```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## Troubleshooting

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

**–ü—Ä–æ–±–ª–µ–º–∞**: `Connection refused` –∏–ª–∏ `SSL error`

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ö–æ—Å—Ç–∞, –ø–æ—Ä—Ç–∞, –∏–º–µ–Ω–∏ –ë–î, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ca.crt` –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TIMEWEB_DB_SSL=true` –∏ `TIMEWEB_DB_SSL_MODE=verify-full`

### –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: Build failed

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏ –≤ Timeweb
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `package.json` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç `build`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –≤ `dependencies`, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ `devDependencies`

### –ü–æ—Ä—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç (`3001`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –Ω–∞ `0.0.0.0`, –∞ –Ω–µ –Ω–∞ `localhost`

### CORS –æ—à–∏–±–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: `Access-Control-Allow-Origin` –æ—à–∏–±–∫–∞

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `ALLOWED_ORIGINS` - –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ—á–Ω—ã–π –¥–æ–º–µ–Ω Vercel —Å `https://`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd server
npm install

# –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
npm run dev

# –°–±–æ—Ä–∫–∞
npm run build

# –ó–∞–ø—É—Å–∫ production –≤–µ—Ä—Å–∏–∏
npm start
```

## –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –±—ç–∫–µ–Ω–¥–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –¥–µ–ø–ª–æ—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ Vercel (—Å–º. `VERCEL_DEPLOY_STEP_BY_STEP.md`).
